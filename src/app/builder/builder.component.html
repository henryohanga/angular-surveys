<!-- header removed; using global site-topbar from AppComponent -->

<section class="builder-layout" aria-label="Survey Builder layout">
  <aside class="left-panel" aria-label="Pages and Import Export">
    <h3>Pages</h3>
    <mat-nav-list>
      <a mat-list-item *ngFor="let p of formDef.pages; let i = index" (click)="selectedPage = i" (keyup.enter)="selectedPage = i" tabindex="0">
        Page {{ p.number }}
      </a>
    </mat-nav-list>
    <button mat-stroked-button (click)="addPage()">+ Add Page</button>
    <h3>Import / Export</h3>
    <button mat-stroked-button color="primary" (click)="exportJson()">Export JSON</button>
    <button mat-stroked-button color="accent" (click)="importJson()">Import JSON</button>
    <button mat-stroked-button (click)="exportToFile()">Download JSON</button>
    <input type="file" accept="application/json" (change)="importFromFile($event)" aria-label="Upload JSON file" />
    <mat-form-field appearance="outline" class="full">
      <mat-label>JSON</mat-label>
      <textarea matInput rows="8" [(ngModel)]="importText" aria-label="JSON input"></textarea>
    </mat-form-field>
    <div *ngIf="importError" class="error" role="alert">{{ importError }}</div>
  </aside>

  <main class="center-panel" aria-label="Survey editing area">
    <mat-card class="survey-meta">
      <input class="title-input" placeholder="Untitled Survey" [value]="formDef.pages[selectedPage].name || ''" (input)="updatePageName($any($event.target).value)" aria-label="Survey title" />
      <input class="desc-input" placeholder="Survey description..." [value]="formDef.pages[selectedPage].description || ''" (input)="updatePageDescription($any($event.target).value)" aria-label="Survey description" />
    </mat-card>

    <div cdkDropList (cdkDropListDropped)="drop($event)">
      <mat-card class="question-card" *ngFor="let el of formDef.pages[selectedPage].elements; let i = index" [@fadeIn]="i" cdkDrag>
        <div class="question-header">
          <div class="question-title">Question</div>
          <div class="question-actions">
            <button mat-icon-button aria-label="Edit question" (click)="editQuestion(i)"><mat-icon>edit</mat-icon></button>
            <button mat-icon-button aria-label="Delete question" (click)="deleteQuestion(i)"><mat-icon>delete</mat-icon></button>
          </div>
        </div>
        <mat-form-field appearance="outline" class="full">
          <mat-label>{{ el.question.text }}</mat-label>
          <input matInput [placeholder]="el.question.text" disabled />
        </mat-form-field>
        <div class="question-footer">
          <mat-checkbox [checked]="!!el.question.required" (change)="editQuestion(i)" aria-label="Required">Required</mat-checkbox>
          <span class="type-label" aria-label="Question type">{{ el.question.type }}</span>
        </div>
      </mat-card>
    </div>

    <button class="add-question" type="button" (click)="openEditor()" aria-label="Add Question">+ Add Question</button>
  </main>

  <aside class="right-panel" aria-label="Properties">
    <h3>Properties</h3>
    <p *ngIf="!editorOpen">Select a question to edit properties</p>
    <div *ngIf="editorOpen" class="editor-host">
      <app-question-editor [initial]="editingInitial" (save)="addQuestion($event)" (dismissed)="closeEditor()"></app-question-editor>
    </div>
  </aside>
</section>
