<mat-card>
  <h2>Survey Builder</h2>
  <div class="layout">
    <div class="sidebar">
      <h3>Pages</h3>
      <mat-nav-list>
        <a mat-list-item *ngFor="let p of formDef.pages; let i = index" (click)="selectedPage = i" (keyup.enter)="selectedPage = i" tabindex="0">
          Page {{ p.number }}
        </a>
      </mat-nav-list>
      <button mat-button (click)="addPage()">Add Page</button>
      <h3>Page Settings</h3>
      <mat-form-field appearance="outline" class="full">
        <mat-label>Name</mat-label>
        <input matInput [ngModel]="formDef.pages[selectedPage].name" (ngModelChange)="updatePageName($event)" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="full">
        <mat-label>Description</mat-label>
        <textarea matInput rows="3" [ngModel]="formDef.pages[selectedPage].description" (ngModelChange)="updatePageDescription($event)"></textarea>
      </mat-form-field>
      <mat-checkbox [ngModel]="formDef.pages[selectedPage].namedPage" (ngModelChange)="updateNamedPage($event)">Named page</mat-checkbox>
      <h3>Page Flow</h3>
      <mat-form-field appearance="outline" class="full">
        <mat-label>Go to page</mat-label>
        <mat-select [ngModel]="formDef.pages[selectedPage].pageFlow?.goToPage" (ngModelChange)="setPageGoTo($event)">
          <mat-option [value]="null">None</mat-option>
          <mat-option *ngFor="let n of pageNumbers()" [value]="n">Page {{ n }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-checkbox [ngModel]="formDef.pages[selectedPage].pageFlow?.nextPage" (ngModelChange)="setPageNext($event)">Next page</mat-checkbox>
      <h3>Import / Export</h3>
      <button mat-stroked-button color="primary" (click)="exportJson()">Export JSON</button>
      <button mat-stroked-button color="accent" (click)="importJson()">Import JSON</button>
      <button mat-stroked-button (click)="exportToFile()">Download JSON</button>
      <input type="file" accept="application/json" (change)="importFromFile($event)" />
      <mat-form-field appearance="outline" class="full">
        <mat-label>JSON</mat-label>
        <textarea matInput rows="8" [(ngModel)]="importText"></textarea>
      </mat-form-field>
      <div *ngIf="importError" class="error">{{ importError }}</div>
    </div>
    <div class="content">
      <h3>Questions (Page {{ formDef.pages[selectedPage].number }})</h3>
      <div cdkDropList (cdkDropListDropped)="drop($event)">
        <div *ngFor="let el of formDef.pages[selectedPage].elements; let i = index" cdkDrag>
          <mat-card class="q-item">
            {{ el.question.text }} ({{ el.question.type }})
            <span class="actions">
              <button mat-button type="button" (click)="editQuestion(i)" (keyup.enter)="editQuestion(i)" tabindex="0">Edit</button>
              <button mat-button color="warn" type="button" (click)="deleteQuestion(i)" (keyup.enter)="deleteQuestion(i)" tabindex="0">Delete</button>
            </span>
          </mat-card>
        </div>
      </div>
      <button mat-raised-button color="primary" (click)="openEditor()">Add Question</button>
      <app-question-editor *ngIf="editorOpen" [initial]="editingInitial" (dismissed)="closeEditor()" (save)="addQuestion($event)"></app-question-editor>
    </div>
  </div>
</mat-card>
