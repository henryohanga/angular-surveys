<mat-card *ngIf="!showSummary">
  <h2>{{ formDef.name }}</h2>
  <p>{{ formDef.description }}</p>

  <form [formGroup]="form" (ngSubmit)="submit()">
    <ng-container *ngFor="let el of formDef.pages[currentPage].elements">
      <app-question-host [question]="el.question" [form]="form"></app-question-host>
      <hr />
    </ng-container>

    <div class="nav">
      <button mat-button type="button" (click)="prev()" [disabled]="currentPage===0">Back</button>
      <span>Page {{ currentPage + 1 }} of {{ formDef.pages.length }}</span>
      <button mat-raised-button color="primary" type="button" (click)="next()" *ngIf="currentPage < formDef.pages.length - 1">Next</button>
      <button mat-stroked-button type="button" (click)="showSummary = true" *ngIf="currentPage === formDef.pages.length - 1">Review</button>
    </div>
  </form>
</mat-card>

<mat-card *ngIf="showSummary">
  <h2>Review</h2>
  <p>Confirm your answers before submitting.</p>
  <div class="summary">
    <ng-container *ngFor="let p of formDef.pages">
      <div class="summary-item" *ngFor="let el of p.elements">
        <strong>{{ el.question.text }}</strong>
        <span *ngIf="!el.question.grid">{{ answerLabel(el.question.id, form.get(el.question.id)?.value) }}</span>
        <span *ngIf="el.question.grid">
          <div *ngFor="let r of gridRowsFor(el.question.id)">
            {{ r.label }}: 
            <span [style.color]="gridRowInvalid(el.question.id, r.id) ? '#b00020' : ''">
              {{ gridRowValueLabel(el.question.id, r.id) || 'â€”' }}
            </span>
          </div>
        </span>
      </div>
    </ng-container>
  </div>
  <div class="nav">
    <button mat-button type="button" (click)="prev()">Back</button>
    <button mat-raised-button color="accent" type="button" (click)="submit()">Submit</button>
  </div>
</mat-card>
