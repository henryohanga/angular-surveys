<!-- Demo Banner -->
@if (isDemo) {
<div class="demo-banner">
  <mat-icon>science</mat-icon>
  <span
    ><strong>Demo Mode</strong> — This is a sample survey to showcase features.
    Responses are not saved.</span
  >
  <a routerLink="/register" class="demo-cta">Create Your Own</a>
</div>
}

<!-- Survey Form -->
@if (!showSummary && !showSuccess) {
<div class="survey-container">
  <!-- Survey Header -->
  <div class="survey-header">
    <h2>{{ formDef.name || "Survey" }}</h2>
    @if (formDef.description) {
    <p>{{ formDef.description }}</p>
    }
  </div>
  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-info">
      <span class="progress-label">{{
        formDef.pages[currentPage].name || "Page " + (currentPage + 1)
      }}</span>
      <span class="progress-count"
        >{{ currentPage + 1 }} of {{ formDef.pages.length }}</span
      >
    </div>
    <div class="progress-bar">
      <div
        class="progress-fill"
        [style.width.%]="((currentPage + 1) / formDef.pages.length) * 100"
      ></div>
    </div>
  </div>
  <!-- Questions -->
  <div class="questions-area">
    <form [formGroup]="form" (ngSubmit)="submit()">
      @for (el of formDef.pages[currentPage].elements; track el; let i = $index)
      {
      <div class="question-block">
        <app-question-host
          [question]="el.question"
          [form]="form"
        ></app-question-host>
      </div>
      }
    </form>
  </div>
  <!-- Navigation -->
  <div class="nav">
    @if (currentPage > 0) {
    <button mat-stroked-button type="button" (click)="prev()">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
    } @if (formDef.pages.length > 1) {
    <span class="page-indicator"
      >Page {{ currentPage + 1 }} of {{ formDef.pages.length }}</span
    >
    }
    <div class="nav-buttons">
      @if (currentPage < formDef.pages.length - 1) {
      <button mat-raised-button color="primary" type="button" (click)="next()">
        Next
        <mat-icon>arrow_forward</mat-icon>
      </button>
      } @if (currentPage === formDef.pages.length - 1 && formDef.pages.length >
      1) {
      <button mat-raised-button color="accent" type="button" (click)="next()">
        <mat-icon>checklist</mat-icon>
        Review & Submit
      </button>
      } @if (currentPage === formDef.pages.length - 1 && formDef.pages.length
      === 1) {
      <button
        mat-raised-button
        color="accent"
        type="button"
        (click)="submitSinglePage()"
      >
        <mat-icon>send</mat-icon>
        Submit
      </button>
      }
    </div>
  </div>
</div>
}

<!-- Summary / Review -->
@if (showSummary && !showSuccess) {
<div class="survey-container">
  <div class="survey-header">
    <h2>Review Your Answers</h2>
    <p>Please confirm your responses before submitting.</p>
  </div>
  <div class="questions-area">
    <div class="summary">
      @for (p of formDef.pages; track p) { @for (el of p.elements; track el) {
      <div class="summary-item">
        <strong>{{ el.question.text }}</strong>
        @if (!el.question.grid) {
        <span>{{
          answerLabel(el.question.id, form.get(el.question.id)?.value) || "—"
        }}</span>
        } @if (el.question.grid) {
        <span>
          @for (r of gridRowsFor(el.question.id); track r) {
          <div>
            {{ r.label }}:
            <span
              [style.color]="
                gridRowInvalid(el.question.id, r.id) ? 'var(--danger)' : ''
              "
            >
              {{ gridRowValueLabel(el.question.id, r.id) || "—" }}
            </span>
          </div>
          }
        </span>
        }
      </div>
      } }
    </div>
  </div>
  <div class="nav">
    <button mat-stroked-button type="button" (click)="prev()">
      <mat-icon>arrow_back</mat-icon>
      Edit Responses
    </button>
    <button mat-raised-button color="accent" type="button" (click)="submit()">
      <mat-icon>send</mat-icon>
      Submit Survey
    </button>
  </div>
</div>
}

<!-- Success Screen -->
@if (showSuccess) {
<div class="survey-container">
  <div class="survey-header">
    <h2>Thank you!</h2>
    <p>Your response has been submitted.</p>
  </div>
  <div class="nav">
    <button
      mat-raised-button
      color="primary"
      type="button"
      (click)="
        showSuccess = false; currentPage = 0; showSummary = false; form.reset()
      "
    >
      <mat-icon>refresh</mat-icon>
      Submit another
    </button>
    <button mat-stroked-button type="button" (click)="showSuccess = false">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
  </div>
</div>
}
